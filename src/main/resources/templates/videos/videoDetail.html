<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="fragments/fragments.html :: head"></head>
<body>
<header th:replace="fragments/fragments.html :: header"></header>
<div th:replace="fragments/fragments.html :: message"></div>
<div class="video-detail__container">
    <div class="videoPlayer" id="jsVideoPlayer">
        <video>
            <!--            비디오 삽입-->
        </video>
        <div class="videoPlayer__controls">
            <div class="videoPlayer__column">
                <span id="jsVolumeBtn"><i class="fas fa-volume-up"></i></span>
                <span>
                    <span id="currentTime">00:00:00</span>
                    <span>/</span>
                    <span id="totalTime">00:00:00</span>
                </span>
                <input type="range" class="videoPlayer__volume" id="jsVolume" min="0" max="1" value="0.5" step="0.1">
            </div>
            <div class="videoPlayer__column">
                <span id="jsPlayButton"><i class="fas fa-play"></i></span>
            </div>
            <div class="videoPlayer__column">
                <span id="jsFullScreen"><i class="fas fa-expand"></i></span>
            </div>
        </div>
    </div>

    <div class="video__info">
        <a th:if="${member.email == video.creator.email}" th:href="@{'/videos/' + ${video.id} + '/edit'}">
            <button>Edit Video</button>
        </a>
        <h5 class="video__title" th:text="${video.title}">Video Title</h5>
        <p class="video__description" th:text="${video.description}">Video Description</p>
        <span th:if="${video.views == 1}" class="video__views" th:text="${video.views} + ' view'">1</span>
        <span th:if="${video.views > 1}" class="video__views" th:text="${video.views} + ' views'">1</span>
        <div class="video__author">
            Upload By <a th:href="@{'/members/profile/' + ${video.creator.name}}" th:text="${video.creator.name}"></a>
        </div>
    </div>
</div>
<div class="comment-container">
    <div class="comment-container__input">
        <div class="mb-3 form-group">
            <label for="newCommentText" id="createCommentLabel">댓글 남기기</label>
            <textarea class="form-control" id="newCommentText" name="content" placeholder="댓글을 남겨주세요"
                      required></textarea>
            <div class="invalid-feedback">3자에서 200자 사이로 입력해 주세요</div>
        </div>
        <div class="comment-container__input-button">
            <button class="btn btn-primary" type="submit" id="commentAddBtn">댓글 작성</button>
        </div>
    </div>

    <div class="comment-container__timeline">
        <span th:if="${video.comments.size() == 1}" th:text="${video.comments.size() + ' comment'}"
              class="video__comment-number"></span>
        <span th:if="${video.comments.size() > 1}" th:text="${video.comments.size() + ' comments'}"
              class="video__comment-number"></span>
        <span th:if="${video.comments.size() == 0}" th:text="${video.comments.size() + ' comment'}"
              class="video__comment-number">0 comment</span>

        <ul class="time-label flex" id="commentList">
            <!--            ajax요청으로 댓글 삽입-->
            <li class="card" th:data-commentId="${comment.id}" th:each="comment : ${video.comments}">
                <div class="card-header">
                    <a th:href="@{'/members/profile/' + ${comment.name}}" th:text="${comment.name}">Joohyuk</a>
                    <span class="fromNow" th:text="${comment.modifiedDateTime}">10분 전</span>
                </div>
                <div class="card-body">
                    <p class="card-text" th:text="${comment.text}">동영상 시청 잘 했습니다!!!</p>
                    <div id="comment-modify-button" th:if="${comment.isWriter(#authentication.getPrincipal())}">
                        <!--                        TODO: 수정 삭제 처리 핸들러 생성-->
                        <a data-toggle="modal" data-target="#modifyCommentModal" th:data-id="${comment.id}"
                           class="badge badge-primary">수정</a>
                        <a data-toggle="modal" data-target="#deleteCommentModal"
                           class="badge badge-primary">삭제</a>
                    </div>
                </div>
            </li>
        </ul>

        <!--        TODO: Pagination 작업-->
        <ul class="pagination pagination-sm justify-content-center">
            <!--페이지 버튼 삽입-->
            <li class="page-item disabled">
                <span class="page-link">Previous</span>
            </li>
            <li class="page-item"><a class="page-link" href="#">1</a></li>
            <li class="page-item active" aria-current="page">
                        <span class="page-link">
                        2
                        <span class="sr-only">(current)</span>
                        </span>
            </li>
            <li class="page-item"><a class="page-link" href="#">3</a></li>
            <li class="page-item">
                <a class="page-link" href="#">Next</a>
            </li>
        </ul>
    </div>
</div>

<!-- 수정 모달창-->
<div class="modal fade" id="modifyCommentModal" tabindex="-1" role="dialog"
     aria-labelledby="modifyCommentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">댓글 수정</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body form-group">
                <p>댓글을 수정해주세요.</p>
                <textarea class="form-control" id="modifyCommentText" name="text"
                          placeholder="댓글을 작성해 주세요"
                          required></textarea>
                <div class="invalid-feedback">3자에서 200자 사이로 입력해 주세요</div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" type="button" aria-describedby="submitHelp"
                        id="commentModifyButton">수정
                </button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
            </div>
        </div>
    </div>
</div>
<!-- 삭제 모달창 -->
<div class="modal fade" id="deleteCommentModal" tabindex="-1" role="dialog" aria-labelledby="leaveTitle"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">댓글 삭제</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p><strong>삭제</strong> 하시겠습니까?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" type="submit" aria-describedby="submitHelp"
                        id="replyDeleteButton">삭제
                </button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
            </div>
        </div>
    </div>
</div>
</body>
<footer th:replace="fragments/fragments.html :: footer"></footer>
<div class="videoId" th:id="${video.id}"></div>
<input type="hidden" id="videoCreatorName" th:value="${video.creator.name}">
<input type="hidden" id="currentMemberName" th:value="${member.name}">
<script src="/js/videoPlayer.js"></script>
<script src="/js/addComment.js"></script>
<script>
    $(function () {
        moment.locale('ko');
        $(".fromNow").text(function (index, dateTime) {
            return moment(dateTime, "YYYY-MM-DD`T`hh:mm").fromNow();
        });
    })
</script>
<script id="template" type="text/x-handlebars-template">
    <li class="card" data-commentId="{{id}}">
        <div class="card-header">
            <a href="/members/profile/{{name}}">{{name}}</a>
            <span class="fromNow">{{modifiedDateTime}}</span>
        </div>
        <div class="card-body">
            <p class="card-text">{{text}}</p>
            {{#if isWriter}}
                <div id="comment-modify-button">
                    <!--                        TODO: 수정 삭제 처리 핸들러 생성-->
                    <a data-toggle="modal" data-target="#modifyCommentModal"
                       class="badge badge-primary" data-id="{{id}}">수정</a>
                    <a data-toggle="modal" data-target="#deleteCommentModal"
                       class="badge badge-primary">삭제</a>
                </div>
            {{/if}}
        </div>
    </li>
</script>
</html>